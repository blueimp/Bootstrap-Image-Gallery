(function(c){c.widget("blueimp.imagegallery",{options:{namespace:void 0,selector:"a[rel=gallery]",modalSelector:"#gallery-modal",loaderSelector:"#gallery-loader",backdrop:!0,keyboard:!0,offsetWidth:100,offsetHeight:200,canvas:!1,slideshow:0},_load:function(b){var a=b.data.gallery,d=a.options,e=c(window).width(),f=c(window).height(),g=a._modal.hasClass("fullscreen");b.preventDefault();a._abortHandler();window.clearTimeout(a._slideShow);a.defer=c.Deferred();a._isModalLink=c(this).parent().hasClass("modal-footer");
a._isModalLink?(a._currentLink=c(this).hasClass("next")?c(a._currentLink).data("next"):c(a._currentLink).data("prev"),a._modal.removeClass("in")):(a._initLinks(),a._currentLink=this,a._initAbortHandlers());a._isModalLink&&a._transition&&a._modal.hasClass("fade")?a._modal.bind(a._transitionEnd+"."+d.namespace,function(b){b.target===a._modal[0]&&(a._modal.unbind(a._transitionEnd+"."+d.namespace),a._initModal(),a.defer.resolve())}):(a._modal.hide(),a._initModal(),a.defer.resolve());b=g?{minWidth:e,minHeight:f,
maxWidth:e,maxHeight:f,canvas:d.canvas}:{maxWidth:e-d.offsetWidth,maxHeight:f-d.offsetHeight,canvas:d.canvas};a._loadingImageTimeout=window.setTimeout(function(){a._loader.addClass("in")},100);a._loadingImage=window.loadImage(a._currentLink.href,function(b){a._loadHandler(b)},b);a._preload()},_loadHandler:function(b){var a=this;this._abortHandler();this._isModalLink?this.defer.done(function(){a._modal.show();a._modal.addClass("in");a._initModalBody(b)}):(this._initModalBody(b),this._modal.modal("show"));
if(this.options.slideshow)this._slideShow=window.setTimeout(function(){a._next()},this.options.slideshow)},_initLinks:function(){var b=c(this.element).find(this.options.selector);b.each(function(a,d){var e=b[a-1],f=b[a+1];if(!e||e.href===d.href)if(e=b[a-2],!e||e.href===d.href)e=b[b.length-1];if(!f||f.href===d.href)if(f=b[a+2],!f||f.href===d.href)f=b[0];c(d).data("prev",e);c(d).data("next",f)})},_initModal:function(){var b=c(this._currentLink).data("prev"),a=c(this._currentLink).data("next");this._modalTitle.text(this._currentLink.title);
this._modalDownload.prop("href",this._currentLink.href);this._modalPrev.prop("href",b.href).prop("title",b.title);this._modalNext.prop("href",a.href).prop("title",a.title)},_initModalBody:function(b){this._modalBody.empty().append(b);this._modal.css("margin-top",-(this._modal.outerHeight()/2)).css("margin-left",-(this._modal.outerWidth()/2))},_preload:function(){c("<img>").prop("src",c(this._currentLink).data("next").href);c("<img>").prop("src",c(this._currentLink).data("prev").href)},_abortHandler:function(){window.clearTimeout(this._loadingImageTimeout);
this._destroyAbortHandlers();if(this._loadingImage)this._loadingImage.onload=this._loadingImage.onerror=null;this._loader.removeClass("in")},_escapeHandler:function(b){var a=b.data.gallery;27===b.keyCode&&a._abortHandler()},_documentClickHandler:function(b){var a=b.data.gallery;c(b.target).closest(a._currentLink).length||a._abortHandler()},_initAbortHandlers:function(){var b={gallery:this};c(document).bind("keydown."+this.options.namespace,b,this._escapeHandler).bind("click."+this.options.namespace,
b,this._documentClickHandler)},_destroyAbortHandlers:function(){c(document).unbind("keydown."+this.options.namespace,this._escapeHandler).unbind("click."+this.options.namespace,this._documentClickHandler)},_prev:function(){this._modalPrev.click()},_next:function(){this._modalNext.click()},_keyHandler:function(b){var a=b.data.gallery;switch(b.which){case 37:case 38:return a._prev(),!1;case 39:case 40:return a._next(),!1}},_wheelHandler:function(b){var a=b.data.gallery,b=b.originalEvent;a._wheelCounter=
a._wheelCounter||0;a._wheelCounter+=b.wheelDelta||b.detail||0;if(b.wheelDelta&&120<=a._wheelCounter||!b.wheelDelta&&0>a._wheelCounter)a._prev(),a._wheelCounter=0;else if(b.wheelDelta&&-120>=a._wheelCounter||!b.wheelDelta&&0<a._wheelCounter)a._next(),a._wheelCounter=0;return!1},_showHandler:function(b){var b=b.data.gallery,a=b.options,d={gallery:b};c(document).bind("keydown."+a.namespace,d,b._keyHandler).bind("mousewheel."+a.namespace+", DOMMouseScroll."+a.namespace,d,b._wheelHandler)},_hideHandler:function(b){var b=
b.data.gallery,a=b.options;c(document).unbind("keydown."+a.namespace,b._keyHandler).unbind("mousewheel."+a.namespace+", DOMMouseScroll."+a.namespace,b._wheelHandler);b._abortHandler();window.clearTimeout(b._slideShow)},_initEventHandlers:function(){var b=this,a={gallery:this};c(this.element).delegate(this.options.selector,"click."+this.options.namespace,a,this._load);this._modalPrev.bind("click."+this.options.namespace,a,this._load);this._modalNext.bind("click."+this.options.namespace,a,this._load);
this._modalBody.bind("click."+this.options.namespace,a,function(a){a.altKey?b._prev():b._next()});this._modal.bind("show."+this.options.namespace,a,this._showHandler).bind("hide."+this.options.namespace,a,this._hideHandler)},_destroyEventHandlers:function(){this._modalPrev.unbind("click."+this.options.namespace);this._modalNext.unbind("click."+this.options.namespace);this._modalBody.unbind("click."+this.options.namespace);this._modal.unbind("show."+this.options.namespace).unbind("hide."+this.options.namespace);
c(this.element).undelegate(this.options.selector,"click."+this.options.namespace)},_initTransitionSupport:function(){var b=(document.body||document.documentElement).style,a="."+this.options.namespace;if(this._transition=void 0!==b.transition||void 0!==b.WebkitTransition||void 0!==b.MozTransition||void 0!==b.MsTransition||void 0!==b.OTransition)this._transitionEnd=["TransitionEnd","webkitTransitionEnd","transitionend","oTransitionEnd"].join(a+" ")+a},_create:function(){this.options.namespace=this.options.namespace||
this.widgetName;this._modal=c(this.options.modalSelector).modal({backdrop:this.options.backdrop,keyboard:this.options.keyboard});this._loader=c(this.options.loaderSelector);this._modalTitle=this._modal.find(".modal-header .title");this._modalBody=this._modal.find(".modal-body");this._modalDownload=this._modal.find(".modal-footer .download");this._modalPrev=this._modal.find(".modal-footer .prev");this._modalNext=this._modal.find(".modal-footer .next");this._initTransitionSupport();this._initEventHandlers()},
destroy:function(){window.clearTimeout(this._slideShow);this._destroyEventHandlers();c.Widget.prototype.destroy.call(this)}})})(jQuery);