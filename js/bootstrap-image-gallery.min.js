(function(c){"function"===typeof define&&define.amd?define(["jquery","load-image","bootstrap"],c):c(window.jQuery,window.loadImage)})(function(c,h){c.extend(c.fn.modal.defaults,{delegate:document,selector:null,filter:"*",index:0,href:null,preloadRange:2,offsetWidth:100,offsetHeight:200,canvas:!1,slideshow:0,imageClickDivision:0.5,wheelHandler:1,wide:0});var j=c.fn.modal.Constructor.prototype.show,k=c.fn.modal.Constructor.prototype.hide;c.extend(c.fn.modal.Constructor.prototype,{initLinks:function(){var a=
this,b=this.options,e=b.selector||"a[data-target="+b.target+"]";this.$links=c(b.delegate).find(e).filter(b.filter).each(function(c){a.getUrl(this)===b.href&&(b.index=c)});this.$links[b.index]||(b.index=0)},getUrl:function(a){return a.href||c(a).data("href")},startSlideShow:function(){var a=this;this.options.slideshow&&(this._slideShow=window.setTimeout(function(){a.next()},this.options.slideshow))},stopSlideShow:function(){window.clearTimeout(this._slideShow)},toggleSlideShow:function(){var a=this.$element.find(".modal-slideshow");
this.options.slideshow?(this.options.slideshow=0,this.stopSlideShow()):(this.options.slideshow=a.data("slideshow")||5E3,this.startSlideShow());a.find("i").toggleClass("icon-play icon-pause")},preloadImages:function(){var a=this.options,b=a.index+a.preloadRange+1,e,d;for(d=a.index-a.preloadRange;d<b;d+=1)(e=this.$links[d])&&d!==a.index&&c("<img>").prop("src",this.getUrl(e))},loadImage:function(){var a=this,b=this.$element,c=this.options.index,d=this.getUrl(this.$links[c]),f;this.abortLoad();this.stopSlideShow();
b.trigger("beforeLoad");this._loadingTimeout=window.setTimeout(function(){b.addClass("modal-loading")},100);f=b.find(".modal-image").children().removeClass("in");window.setTimeout(function(){f.remove()},3E3);b.find(".modal-title").text(this.$links[c].title);b.find(".modal-download").prop("href",d);this._loadingImage=h(d,function(c){a.img=c;window.clearTimeout(a._loadingTimeout);b.removeClass("modal-loading");b.trigger("load");a.showImage(c);a.startSlideShow()},this._loadImageOptions);this.preloadImages()},
showImage:function(a){var b=this.$element,e=c.support.transition&&b.hasClass("fade"),d=e?b.animate:b.css,f=b.find(".modal-image"),g;f.css({width:a.width,height:a.height});b.find(".modal-title").css({width:Math.max(a.width,380)});e&&(g=b.clone().hide().appendTo(document.body));1==this.options.wide&&767<c(window).width()?d.call(b.stop(),{"margin-left":-((g||b).outerWidth()/2),"margin-top":"0","padding-top":(c(window).height()-a.height)/2,width:c(window).width()}):767<c(window).width()?d.call(b.stop(),
{"margin-top":-((g||b).outerHeight()/2),"margin-left":-((g||b).outerWidth()/2),"padding-top":"0",width:"auto"}):b.css({"padding-top":"0",top:(c(window).height()-(g||b).outerHeight())/2,width:"auto"});g&&g.remove();f.append(a);b.trigger("display");e?b.is(":visible")?c(a).on(c.support.transition.end,function(e){e.target===a&&(c(a).off(c.support.transition.end),b.trigger("displayed"))}).addClass("in"):(c(a).addClass("in"),b.one("shown",function(){b.trigger("displayed")})):(c(a).addClass("in"),b.trigger("displayed"))},
abortLoad:function(){this._loadingImage&&(this._loadingImage.onload=this._loadingImage.onerror=null);window.clearTimeout(this._loadingTimeout)},prev:function(){var a=this.options;a.index-=1;0>a.index&&(a.index=this.$links.length-1);this.loadImage()},next:function(){var a=this.options;a.index+=1;a.index>this.$links.length-1&&(a.index=0);this.loadImage()},keyHandler:function(a){switch(a.which){case 37:case 38:a.preventDefault();this.prev();break;case 39:case 40:a.preventDefault(),this.next()}},wheelHandler:function(a){a.preventDefault();
a=a.originalEvent;this._wheelCounter=this._wheelCounter||0;this._wheelCounter+=a.wheelDelta||a.detail||0;if(a.wheelDelta&&120<=this._wheelCounter||!a.wheelDelta&&0>this._wheelCounter)this.prev(),this._wheelCounter=0;else if(a.wheelDelta&&-120>=this._wheelCounter||!a.wheelDelta&&0<this._wheelCounter)this.next(),this._wheelCounter=0},initGalleryEvents:function(){var a=this,b=this.$element;b.find(".modal-image").on("click.modal-gallery",function(b){var d=c(this);1===a.$links.length?a.hide():(b.pageX-
d.offset().left)/d.width()<a.options.imageClickDivision?a.prev(b):a.next(b)});b.find(".modal-prev").on("click.modal-gallery",function(b){a.prev(b)});b.find(".modal-next").on("click.modal-gallery",function(b){a.next(b)});b.find(".modal-slideshow").on("click.modal-gallery",function(b){a.toggleSlideShow(b)});c(document).on("keydown.modal-gallery",function(b){a.keyHandler(b)});if(1==this.options.wheelhandler)c(document).on("mousewheel.modal-gallery, DOMMouseScroll.modal-gallery",function(b){a.wheelHandler(b)})},
destroyGalleryEvents:function(){var a=this.$element;this.abortLoad();this.stopSlideShow();a.find(".modal-image, .modal-prev, .modal-next, .modal-slideshow").off("click.modal-gallery");c(document).off("keydown.modal-gallery").off("mousewheel.modal-gallery, DOMMouseScroll.modal-gallery")},show:function(){if(!this.isShown&&this.$element.hasClass("modal-gallery")){var a=this.$element,b=this.options,e=c(window).width(),d=c(window).height();a.hasClass("modal-fullscreen")?(this._loadImageOptions={maxWidth:e,
maxHeight:d,canvas:b.canvas},a.hasClass("modal-fullscreen-stretch")?(this._loadImageOptions.minWidth=e,this._loadImageOptions.minHeight=d):this.options.wide=a.hasClass("modal-fullscreen-wide")?1:0):(this._loadImageOptions={maxWidth:e-b.offsetWidth,maxHeight:d-b.offsetHeight,canvas:b.canvas},this.options.wide=0);1==this.options.wide&&767<e?a.css({"margin-left":-(a.outerWidth()/2),"margin-top":"0","padding-top":(d-a.outerHeight())/2,width:e}):767<e?a.css({"margin-top":-(a.outerHeight()/2),"margin-left":-(a.outerWidth()/
2),"padding-top":"0",width:"auto"}):a.css({"padding-top":"0",top:(c(window).height()-a.outerHeight())/2,width:"auto"});this.initGalleryEvents();this.initLinks();this.$links.length&&(a.find(".modal-slideshow, .modal-prev, .modal-next").toggle(1!==this.$links.length),a.toggleClass("modal-single",1===this.$links.length),this.loadImage())}j.apply(this,arguments)},hide:function(){this.isShown&&this.$element.hasClass("modal-gallery")&&(this.options.delegate=document,this.options.href=null,this.destroyGalleryEvents());
k.apply(this,arguments)}});c(function(){c(document.body).on("click.modal-gallery.data-api",'[data-toggle="modal-gallery"]',function(a){var b=c(this).data(),e=c(b.target),d=e.data("modal"),f;d||(b=c.extend(e.data(),b));b.selector||(b.selector="a[rel=gallery]");f=c(a.target).closest(b.selector);f.length&&e.length&&(a.preventDefault(),b.href=f.prop("href")||f.data("href"),b.delegate=f[0]!==this?this:document,d&&c.extend(d.options,b),e.modal(b))})})});