(function(a){if(typeof define==="function"&&define.amd){define(["jquery","load-image","bootstrap"],a)}else{a(window.jQuery,window.loadImage)}}(function(c,d){c.extend(c.fn.modal.defaults,{delegate:document,selector:null,filter:"*",index:0,href:null,preloadRange:2,offsetWidth:100,offsetHeight:200,canvas:false,slideshow:0,imageClickDivision:0.5,mousewheel:true});var a=c.fn.modal.Constructor.prototype.show,b=c.fn.modal.Constructor.prototype.hide;c.extend(c.fn.modal.Constructor.prototype,{initLinks:function(){var g=this,f=this.options,e=f.selector||"a[data-target="+f.target+"]";this.$links=c(f.delegate).find(e).filter(f.filter).each(function(h){if(g.getUrl(this)===f.href){f.index=h}});if(!this.$links[f.index]){f.index=0}},getUrl:function(e){return e.href||c(e).data("href")},getDownloadUrl:function(e){return c(e).data("download")},startSlideShow:function(){var e=this;if(this.options.slideshow){this._slideShow=window.setTimeout(function(){e.next()},this.options.slideshow)}},stopSlideShow:function(){window.clearTimeout(this._slideShow)},toggleSlideShow:function(){var e=this.$element.find(".modal-slideshow");if(this.options.slideshow){this.options.slideshow=0;this.stopSlideShow()}else{this.options.slideshow=e.data("slideshow")||5000;this.startSlideShow()}e.find("i").toggleClass("icon-play icon-pause")},preloadImages:function(){var f=this.options,e=f.index+f.preloadRange+1,h,g;for(g=f.index-f.preloadRange;g<e;g+=1){h=this.$links[g];if(h&&g!==f.index){c("<img>").prop("src",this.getUrl(h))}}},loadImage:function(){var j=this,i=this.$element,g=this.options.index,f=this.getUrl(this.$links[g]),e=this.getDownloadUrl(this.$links[g]),h;this.abortLoad();this.stopSlideShow();i.trigger("beforeLoad");this._loadingTimeout=window.setTimeout(function(){i.addClass("modal-loading")},100);h=i.find(".modal-image").children().removeClass("in");window.setTimeout(function(){h.remove()},3000);i.find(".modal-title").text(this.$links[g].title);i.find(".modal-download").prop("href",e||f);this._loadingImage=d(f,function(k){j.img=k;window.clearTimeout(j._loadingTimeout);i.removeClass("modal-loading");i.trigger("load");j.showImage(k);j.startSlideShow()},this._loadImageOptions);this.preloadImages()},showImage:function(e){var h=this.$element,i=c.support.transition&&h.hasClass("fade"),k=i?h.animate:h.css,f=h.find(".modal-image"),j,g;f.css({width:e.width,height:e.height});h.find(".modal-title").css({width:Math.max(e.width,380)});if(i){j=h.clone().hide().appendTo(document.body)}if(c(window).width()>767){k.call(h.stop(),{"margin-top":-((j||h).outerHeight()/2),"margin-left":-((j||h).outerWidth()/2)})}else{h.css({top:(c(window).height()-(j||h).outerHeight())/2})}if(j){j.remove()}f.append(e);g=e.offsetWidth;h.trigger("display");if(i){if(h.is(":visible")){c(e).on(c.support.transition.end,function(l){if(l.target===e){c(e).off(c.support.transition.end);h.trigger("displayed")}}).addClass("in")}else{c(e).addClass("in");h.one("shown",function(){h.trigger("displayed")})}}else{c(e).addClass("in");h.trigger("displayed")}},abortLoad:function(){if(this._loadingImage){this._loadingImage.onload=this._loadingImage.onerror=null}window.clearTimeout(this._loadingTimeout)},prev:function(){var e=this.options;e.index-=1;if(e.index<0){e.index=this.$links.length-1}this.loadImage()},next:function(){var e=this.options;e.index+=1;if(e.index>this.$links.length-1){e.index=0}this.loadImage()},keyHandler:function(f){switch(f.which){case 37:case 38:f.preventDefault();this.prev();break;case 39:case 40:f.preventDefault();this.next();break}},wheelHandler:function(f){if(this.options.mousewheel==true){f.preventDefault();f=f.originalEvent;this._wheelCounter=this._wheelCounter||0;this._wheelCounter+=(f.wheelDelta||f.detail||0);if((f.wheelDelta&&this._wheelCounter>=120)||(!f.wheelDelta&&this._wheelCounter<0)){this.prev();this._wheelCounter=0}else{if((f.wheelDelta&&this._wheelCounter<=-120)||(!f.wheelDelta&&this._wheelCounter>0)){this.next();this._wheelCounter=0}}}},initGalleryEvents:function(){var f=this,e=this.$element;e.find(".modal-image").on("click.modal-gallery",function(h){var g=c(this);if(f.$links.length===1){f.hide()}else{if((h.pageX-g.offset().left)/g.width()<f.options.imageClickDivision){f.prev(h)}else{f.next(h)}}});e.find(".modal-prev").on("click.modal-gallery",function(g){f.prev(g)});e.find(".modal-next").on("click.modal-gallery",function(g){f.next(g)});e.find(".modal-slideshow").on("click.modal-gallery",function(g){f.toggleSlideShow(g)});c(document).on("keydown.modal-gallery",function(g){f.keyHandler(g)}).on("mousewheel.modal-gallery, DOMMouseScroll.modal-gallery",function(g){f.wheelHandler(g)})},destroyGalleryEvents:function(){var e=this.$element;this.abortLoad();this.stopSlideShow();e.find(".modal-image, .modal-prev, .modal-next, .modal-slideshow").off("click.modal-gallery");c(document).off("keydown.modal-gallery").off("mousewheel.modal-gallery, DOMMouseScroll.modal-gallery")},show:function(){if(!this.isShown&&this.$element.hasClass("modal-gallery")){var g=this.$element,e=this.options,f=c(window).width(),h=c(window).height();if(g.hasClass("modal-fullscreen")){this._loadImageOptions={maxWidth:f,maxHeight:h,canvas:e.canvas};if(g.hasClass("modal-fullscreen-stretch")){this._loadImageOptions.minWidth=f;this._loadImageOptions.minHeight=h}}else{this._loadImageOptions={maxWidth:f-e.offsetWidth,maxHeight:h-e.offsetHeight,canvas:e.canvas}}if(f>767){g.css({"margin-top":-(g.outerHeight()/2),"margin-left":-(g.outerWidth()/2)})}else{g.css({top:(c(window).height()-g.outerHeight())/2})}this.initGalleryEvents();this.initLinks();if(this.$links.length){g.find(".modal-slideshow, .modal-prev, .modal-next").toggle(this.$links.length!==1);g.toggleClass("modal-single",this.$links.length===1);this.loadImage()}}a.apply(this,arguments)},hide:function(){if(this.isShown&&this.$element.hasClass("modal-gallery")){this.options.delegate=document;this.options.href=null;this.destroyGalleryEvents()}b.apply(this,arguments)}});c(function(){c(document.body).on("click.modal-gallery.data-api",'[data-toggle="modal-gallery"]',function(k){var j=c(this),f=j.data(),h=c(f.target),i=h.data("modal"),g;if(!i){f=c.extend(h.data(),f)}if(!f.selector){f.selector="a[data-gallery=gallery]"}g=c(k.target).closest(f.selector);if(g.length&&h.length){k.preventDefault();f.href=g.prop("href")||g.data("href");f.delegate=g[0]!==this?this:document;if(i){c.extend(i.options,f)}h.modal(f)}})})}));